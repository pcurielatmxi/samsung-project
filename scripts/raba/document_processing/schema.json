{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RABA Quality Test Report - Analytics",
  "type": "object",
  "properties": {
    "report_date": {
      "type": ["string", "null"],
      "description": "Report date (YYYY-MM-DD)"
    },
    "test_type": {
      "type": "string",
      "description": "Type of test (e.g., 'Compressive Strength', 'Soil Compaction', 'Concrete Testing')"
    },
    "location": {
      "type": ["string", "null"],
      "description": "Location (project, building, area, grid coordinates)"
    },
    "summary": {
      "type": "string",
      "description": "Brief summary of the document and test performed"
    },
    "outcome": {
      "type": "string",
      "enum": ["PASS", "FAIL", "PARTIAL"],
      "description": "Test outcome: PASS (all passed), FAIL (all/any critical failed), PARTIAL (mixed results)"
    },
    "failure_reason": {
      "type": ["string", "null"],
      "description": "Primary reason for failure, quoted from document if available"
    },
    "issues": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "description": {
            "type": "string",
            "description": "Description of the issue or deficiency"
          },
          "severity": {
            "type": ["string", "null"],
            "description": "Severity level if stated (e.g., 'critical', 'minor')"
          }
        },
        "required": ["description"]
      },
      "description": "List of issues, deficiencies, or non-conformances found"
    },
    "parties_involved": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Name of the party"
          },
          "role": {
            "type": "string",
            "description": "Role (e.g., 'contractor', 'subcontractor', 'supplier', 'inspector', 'testing_company')"
          }
        },
        "required": ["name", "role"]
      },
      "description": "List of parties involved in the inspection/test"
    },
    "reinspection_required": {
      "type": ["boolean", "null"],
      "description": "Whether re-inspection or re-testing is required"
    },
    "corrective_action": {
      "type": ["string", "null"],
      "description": "Corrective action noted or required"
    },
    "test_counts": {
      "type": ["object", "null"],
      "properties": {
        "total": {"type": ["integer", "null"]},
        "passed": {"type": ["integer", "null"]},
        "failed": {"type": ["integer", "null"]}
      },
      "description": "Test counts if specified"
    }
  },
  "required": ["test_type", "outcome", "summary"]
}
